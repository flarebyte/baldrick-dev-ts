# Repository Guidelines

## Project Structure & Module Organization
- `src/`: TypeScript source (ESM). CLI entry: `src/cli.mts`; library entry: `src/index.ts`.
- `test/`: Node.js tests (TypeScript). Example: `wrap-and-filter.test.ts`.
- `pest-spec/`: baldrick-pest CLI specs and fixtures (markdown and release smoke tests).
- `dist/`: Build output (generated by `yarn build`).
- `report/`: Generated reports (e.g., Typedoc JSON, CI artifacts).
- `.github/` workflows and `.vscode/` snippets. See `TECHNICAL_DESIGN.md` for a high‑level overview.

## Build, Test, and Development Commands
- `yarn build`: Compile TS to ESM in `dist/` (uses `npx -p typescript@latest tsc`).
- `yarn test:ci`: Run Node.js tests on compiled output (`node --test` on `dist/test/**`).
- `yarn test:cov`: Run tests with coverage (via `npx -p c8@latest c8`).
- `yarn test:pest`: Run baldrick-pest specs (CLI smoke tests for markdown + release).
- `yarn lint`: Lint and format via Biome (`npx -p @biomejs/biome@latest`).
- `yarn lint:fix`: Auto-fix (`biome check --write`).
- `yarn md` / `yarn md:fix`: Check/fix Markdown using the CLI (remark + prettier based).
- `yarn ready`: Markdown checks, `yarn outdated`, `yarn audit`, and `yarn release:check`.
- `yarn h`: Show frequently used commands (`commands.txt`).

## Coding Style & Naming Conventions
- Indentation: 2 spaces (`.editorconfig`).
- Biome is used for linting/formatting (80 cols). Prettier is still used internally for markdown fixing.
- ESM only (`"type": "module"`); use `import`/`export`.
- Filenames: kebab-case for modules; tests end with `.test.ts`.
- Keep functions small and pure; prefer explicit types; avoid one-letter identifiers.

## Testing Guidelines
- Unit tests: Node.js built-in test runner.
  - Naming: `<unit>.test.ts` under `test/`.
  - Run: `yarn test:ci` or `yarn test:cov` for coverage.
- CLI smoke tests: baldrick-pest specs under `pest-spec/`.
  - Run: `yarn test:pest`.
- Aim for meaningful coverage; add tests with new features and bug fixes.

## Commit & Pull Request Guidelines
- Commits: short, imperative subject; reference issues like `(#29)` when applicable.
- Scope descriptive commits (e.g., “Adds support for GitHub markdown”).
- PRs: include purpose, linked issues, before/after notes, and CLI output or screenshots when UI/CLI behavior changes.
- Ensure `yarn ready` passes before requesting review.

## Security & Configuration Tips
- Node.js >= 22 required. Do not commit secrets; prefer environment variables.
- Generated folders (`dist/`, `report/`, `coverage/`) should not be edited or committed.
- For local docs: `yarn doc` (produces `report/doc.json`).

## Agent-Specific Instructions
- Respect this guide and `.editorconfig`.
- Keep changes minimal and focused; avoid API changes without prior discussion.
- Use `npx -p <tool>@latest` for TS/CLI tooling (TypeScript, tsx, c8, Biome, baldrick-pest) rather than adding devDependencies.
- Update tests (Node test + pest specs) and docs when altering behavior.
- Note: The CLI’s lint and test actions are deprecated and only print a “no longer supported” message. Supported actions: `markdown`, `release`.
